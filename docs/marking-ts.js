!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("paper"),require("lodash")):"function"==typeof define&&define.amd?define("MarkingTS",["paper","lodash"],e):"object"==typeof exports?exports.MarkingTS=e(require("paper"),require("lodash")):t.MarkingTS=e(t.paper,t._)}(this,function(t,e){return function(t){function e(e){for(var n,s,a=e[0],c=e[1],h=e[2],l=0,d=[];l<a.length;l++)s=a[l],o[s]&&d.push(o[s][0]),o[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);for(u&&u(e);d.length;)d.shift()();return r.push.apply(r,h||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],n=!0,a=1;a<i.length;a++){var c=i[a];0!==o[c]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=i[0]))}return t}var n={},o={0:0},r=[];function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=this.webpackJsonpMarkingTS=this.webpackJsonpMarkingTS||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var h=0;h<a.length;h++)e(a[h]);var u=c;return r.push([135,1]),i()}({0:function(e,i){e.exports=t},135:function(t,e,i){"use strict";i.r(e);var n,o,r,s,a,c,h=i(146),u=i(2),l=i(139),d=i(136),f=i(0),p=i(59),g=i.n(p);function v(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.ARC="arcGroup",t.GEOMETRY="geometryGroup",t.CONNECTOR="connector"}(n||(n={})),function(t){t.NONE="none",t.ACTIVE="active",t.CHILD="child",t.PARENT="parent",t.DOT="dot",t.HIDDEN="hidden",t.BACK="back",t.BACK_CHILD="backChild",t.SUBMENU="submenu",t.SELECTED="selected",t.ACTIVE_SELECTION="activeSelected"}(o||(o={})),function(t){t.SELECTION="itemSelection",t.SUBMENU="navigationSubmenu",t.BACK="navigationBack",t.BACK_HOVER="navigationBackHover",t.HOVER="itemHover",t.HOVER_SELECTION="itemSelectionHover",t.SLIDER_VALUE_CHANGED="sliderValueChanged"}(r||(r={})),function(t){t.LEFT_CLICK="leftClick",t.RIGHT_CLICK="rightClick"}(s||(s={})),function(t){t.DRAGGING="dragging",t.END="dragEnd"}(a||(a={})),function(t){t.MAIN="main",t.GEOMETRY="geometry",t.CONNECTOR="connector",t.ARC="arc",t.SCALES="scales",t.RADII="radii"}(c||(c={}));var m=c.MAIN,y=c.GEOMETRY,_=c.CONNECTOR,C=c.ARC,E=c.SCALES,k=c.RADII,w=function(){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,"_defaultSettings",(b(e={},c.MAIN,{minDistance:150,minTraceDistance:175,animationDuration:250,enableMaxClickRadius:!0}),b(e,c.GEOMETRY,{size:50,color:"#575859",selectionColor:"#577a85",stroke:{enabled:!0,color:"rgba(62, 62, 64, 1.0)",width:2},text:{color:"#fff"},icon:{color:"#fff"}}),b(e,c.CONNECTOR,{enabled:!0,color:"#393a3c",width:10}),b(e,c.ARC,{enabled:!0,color:[["#575859",.15],["rgba(87, 122, 133, 0.5)",.5],["rgba(74, 159, 158, 0.15)",.8],"rgba(87, 88, 89, 0)"],radial:!0,stroke:{enabled:!0,width:1}}),b(e,c.SCALES,{parent:.5,child:.5,dot:.15,icon:{base:.0625,solo:1.6,child:.7}}),b(e,c.RADII,{child:100,dot:25,arc:300,maxClickRadius:450}),e)),b(this,"_settings",void 0),this._settings=g()(this._defaultSettings,i)}var e,i,n;return e=t,(i=[{key:"defaultSettings",get:function(){return this._defaultSettings}},{key:m,get:function(){return this._settings[c.MAIN]}},{key:y,get:function(){return this._settings[c.GEOMETRY]}},{key:_,get:function(){return this._settings[c.CONNECTOR]}},{key:C,get:function(){return this._settings[c.ARC]}},{key:E,get:function(){return this._settings[c.SCALES]}},{key:k,get:function(){return this._settings[c.RADII]}},{key:"projectStyle",get:function(){return{fillColor:this.geometry.color,strokeColor:this.geometry.stroke.color,strokeWidth:this.geometry.stroke.enabled?this.geometry.stroke.width:0}}}])&&v(e.prototype,i),n&&v(e,n),t}(),S=i(140),I=i(141),O=i(12),A=i(142),T=i(143),G=i(60),D=i(145),R=new f.Point(0,0),L=new f.Point(0,-1),N=new f.Point(1,1);Object.freeze(R),Object.freeze(L),Object.freeze(N);var P=i(137),M=i(20),x=i(138),$=i(63);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function F(t,e,i){return e&&z(t.prototype,e),i&&z(t,i),t}function V(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var W=function(){function t(e){Y(this,t),V(this,"_onStart$",new h.a),V(this,"_onStop$",new h.a),V(this,"_onFinish$",new h.a),V(this,"_onUpdate$",void 0),V(this,"_options",{}),V(this,"_target",void 0),V(this,"_from",void 0),V(this,"_to",void 0),V(this,"_tween",void 0),V(this,"_initialized",!1),void 0!==e&&this.initialize(e)}return F(t,[{key:"initialize",value:function(e){var i=this;this._target=e.target,this._from=t.normalize(e.from||{}),this._to=t.normalize(e.to||{}),this._options=t.parseOptions(e.options||{}),this._tween=this.createTween(e),this._onUpdate$=Object(d.a)(this._tween,"update"),this._tween.then(function(){i._onFinish$.next(i._tween),i._onFinish$.complete()}),this._initialized=!0}},{key:"start",value:function(){if(!this._initialized)throw new Error("Animation not initialized");this._onStart$.next(this._tween),this._tween.start(),this._onStart$.complete()}},{key:"stop",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];void 0!==this._tween&&this._tween.running&&(this._onStop$.next(this._tween),this._tween.stop(),this._onStop$.complete(),t&&void 0!==this._to&&(void 0!==this._to["lastSegment.point"]&&(this._to.lastSegment={point:this._to["lastSegment.point"]},delete this._to["lastSegment.point"]),this._target.set(this._to)))}},{key:"createTween",value:function(t){if(void 0===t.from&&void 0===t.to)throw new Error('Animation is missing "from" and "to" data.');return void 0===t.from?this._target.tweenTo(this._to,{duration:this._options.duration,easing:this._options.easing,start:!1}):void 0===t.to?this._target.tweenFrom(this._from,{duration:this._options.duration,easing:this._options.easing,start:!1}):this._target.tween(this._from,this._to,{duration:this._options.duration,easing:this._options.easing,start:!1})}},{key:"onStart$",get:function(){return this._onStart$.asObservable()}},{key:"onStop$",get:function(){return this._onStop$.asObservable()}},{key:"onFinish$",get:function(){return this._onFinish$.asObservable()}},{key:"onUpdate$",get:function(){if(this._initialized)return this._onUpdate$}},{key:"duration",set:function(t){void 0!==this._options&&(this._options.duration=t),void 0!==this._tween&&(this._tween.duration=t)},get:function(){return this._options&&this._options.duration}},{key:"easing",set:function(t){void 0!==this._options&&(this._options.easing=t),void 0!==this._tween&&(this._tween.easing=t)}},{key:"running",get:function(){return void 0!==this._tween&&this._tween.running}},{key:"target",get:function(){return this._target}}],[{key:"normalize",value:function(t){return"number"==typeof t.scaling&&(0===t.scaling?t.scaling=Number.EPSILON:t.scaling=N.multiply(t.scaling)),t}},{key:"parseOptions",value:function(t){return void 0===t&&(t={}),void 0===t.duration?t.duration=Number.EPSILON:0===t.duration&&(t.duration=Number.EPSILON),void 0===t.easing&&(t.easing="easeOutCubic"),t}}]),t}(),K=function(t){function e(){var t,i,n;Y(this,e),i=this,t=!(n=H(e).call(this))||"object"!==j(n)&&"function"!=typeof n?U(i):n,V(U(t),"_onStart$",new h.a),V(U(t),"_onStop$",new h.a),V(U(t),"_onFinish$",new h.a),V(U(t),"_onUpdate$",new h.a),V(U(t),"_onUpdateGroup$",new h.a),V(U(t),"_onStartChildren",void 0),V(U(t),"_onStopChildren",void 0),V(U(t),"_onFinishChildren",void 0),V(U(t),"_onUpdateChildren",void 0),V(U(t),"_animations",void 0),t._onStartChildren=new Array,t._onStopChildren=new Array,t._onFinishChildren=new Array,t._onUpdateChildren=new Array;for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return r.length>0?(t._animations=r,t._animations.forEach(t.addObservables),t.subscribeSubjects()):t._animations=new Array,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(e,W),F(e,[{key:"push",value:function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];i.forEach(function(e){void 0!==t._options.duration&&e.duration===Number.EPSILON&&(e.duration=t._options.duration),void 0!==t._options.easing&&(e.easing="function"==typeof t._options.easing?t._options.easing:f.Tween.easings[t._options.easing]),t._animations.push(e),t.addObservables(e)})}},{key:"reset",value:function(){this.resetChildren(),this.resetSubjects()}},{key:"resetChildren",value:function(){this._animations.length=0,this._onStartChildren.length=0,this._onStopChildren.length=0,this._onUpdateChildren.length=0,this._onFinishChildren.length=0}},{key:"resetSubjects",value:function(){this._onStart$=new h.a,this._onStop$=new h.a,this._onFinish$=new h.a,this._onUpdate$=new h.a,this._onUpdateGroup$=new h.a}},{key:"start",value:function(){this.subscribeSubjects(),this._animations.forEach(function(t){t.start()})}},{key:"stop",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._animations.forEach(function(e){e.stop(t)})}},{key:"remove",value:function(t){this._animations=this._animations.filter(function(e){return e.target!==t})}},{key:"addObservables",value:function(t){this._onStartChildren.push(t.onStart$),this._onStopChildren.push(t.onStop$),this._onFinishChildren.push(t.onFinish$),this._onUpdateChildren.push(t.onUpdate$)}},{key:"subscribeSubjects",value:function(){var t=this;Object(P.a)(this._onStartChildren).subscribe(this._onStart$),Object(P.a)(this._onStopChildren).subscribe(this._onStop$),Object(P.a)(this._onFinishChildren).subscribe(this._onFinish$),Object(M.a)(this._onUpdateChildren).pipe(Object($.a)()).subscribe(this._onUpdate$),Object(x.a)(this._onUpdateChildren).pipe(Object(O.a)(function(e){return{progress:e.reduce(function(t,e){return t+e.progress},0)/t._onUpdateChildren.length,factor:e.reduce(function(t,e){return t+e.factor},0)/t._onUpdateChildren.length}})).subscribe(this._onUpdateGroup$)}},{key:"onStart$",get:function(){return this._onStart$.asObservable()}},{key:"onStop$",get:function(){return this._onStop$.asObservable()}},{key:"onFinish$",get:function(){return this._onFinish$.asObservable()}},{key:"onUpdate$",get:function(){return this._onUpdate$.asObservable()}},{key:"onUpdateGroup$",get:function(){return this._onUpdateGroup$.asObservable()}},{key:"length",get:function(){return this._animations.length}},{key:"running",get:function(){return void 0!==this._animations.find(function(t){return t.running})}},{key:"duration",set:function(t){this._options.duration=t,this._animations.forEach(function(e){e.duration=t})}},{key:"easing",set:function(t){this._options.easing=t,this._animations.forEach(function(e){e.easing=t})}}]),e}();function X(t){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function J(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Z=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),J(this,"MINIMUM_DISTANCE",100),J(this,"SAMPLING_DISTANCE",20),J(this,"THRESHOLD_ANGLE",Math.PI/t.THRESHOLD),J(this,"PAUSE_DELAY",100),J(this,"_onDirectionChanged$",void 0),J(this,"_onStutter$",void 0),J(this,"_stroke",void 0),J(this,"_timoutId",void 0),this._stroke=Array(),this._onDirectionChanged$=new h.a,this._onStutter$=new h.a,this.MINIMUM_DISTANCE=e[c.MAIN].minTraceDistance}var e,i,n;return e=t,n=[{key:"angle",value:function(t,e){return Math.acos(t.dot(e)/(t.length*e.length))}}],(i=[{key:"reset",value:function(){this._stroke=Array()}},{key:"update",value:function(e){var i=this;if(0!=this._stroke.length){var n=this._stroke[this._stroke.length-1],o=e.getDistance(n);if(o>this.SAMPLING_DISTANCE){var r=o/this.SAMPLING_DISTANCE,s=this._stroke[this._stroke.length-1];"object"===X(this._timoutId)&&(clearTimeout(this._timoutId),delete this._timoutId);for(var a=1;a<=o/this.SAMPLING_DISTANCE;++a){var c=a/r;this._stroke.push(new f.Point(c*e.x+(1-c)*s.x,c*e.y+(1-c)*s.y))}var h=this._stroke.length;this._timoutId=setTimeout(function(){h===i._stroke.length&&e.getDistance(i._stroke[0])>i.MINIMUM_DISTANCE&&(i._onStutter$.next(e),i.reset())},this.PAUSE_DELAY)}if(this._stroke.length>=2)t.angle(this.getStrokeDirection(),e.subtract(this._stroke[0]))>this.THRESHOLD_ANGLE&&e.getDistance(this._stroke[0])>this.MINIMUM_DISTANCE&&(this._onDirectionChanged$.next(n),this.reset())}else this._stroke.push(e)}},{key:"getStrokeDirection",value:function(){var t=this;return this._stroke.reduce(function(e,i,n){return n>0&&(e.x+=i.x/(t._stroke.length-1),e.y+=i.y/(t._stroke.length-1)),e},R.clone()).subtract(this._stroke[0])}},{key:"onDecisionPoint$",get:function(){return Object(l.a)(this.onStutter$,this.onDirectionChanged$)}},{key:"onStutter$",get:function(){return this._onStutter$.asObservable()}},{key:"onDirectionChanged$",get:function(){return this._onDirectionChanged$.asObservable()}}])&&q(e.prototype,i),n&&q(e,n),t}();function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}J(Z,"THRESHOLD",30);var et,it,nt,ot=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"fromSettings",value:function(e){if("string"==typeof e)return t.fromString(e);if(Array.isArray(e))return t.fromArray(e);throw new Error("Invalid color. Accepted formats are string | array")}},{key:"fromString",value:function(e){return t.isTransparent(e)?t.TRANSPARENT:new f.Color(e)}},{key:"fromArray",value:function(e){var i=new Array;if(e.forEach(function(e){if(Array.isArray(e)){var n,o,r=Q(e[0]),s=Q(e[1]);if(2!==e.length)throw new Error("Invalid number of gradient settings. Expected 2 got ".concat(e.length,"."));if(r===s)throw new Error("Invalid gradient settings. [".concat(r,", ").concat(s,"] does not match expected format [string, number]."));"string"===r?(n=e[0],o=e[1]):(n=e[1],o=e[0]),t.isTransparent(n)&&(n="rgba(255, 255, 255, 0)"),i.push(new f.GradientStop(t.fromString(n),o))}else{if(t.isTransparent(e))return void i.push(new f.GradientStop(t.TRANSPARENT));i.push(new f.GradientStop(t.fromString(e)))}}),1===e.length)return i[0].color;var n=new f.Gradient;return n.stops=i,n}},{key:"isTransparent",value:function(t){return"transparent"===t.toLowerCase()}}],(i=null)&&tt(e.prototype,i),n&&tt(e,n),t}();function rt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function st(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}et=ot,it="TRANSPARENT",nt=new f.Color(255,255,255,0),it in et?Object.defineProperty(et,it,{value:nt,enumerable:!0,configurable:!0,writable:!0}):et[it]=nt;var at=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),st(this,"inputActivation$",void 0),st(this,"inputDeactivation$",void 0),st(this,"inputPosition$",void 0),st(this,"_inputPosition",R),st(this,"_click$",void 0),st(this,"_dragging$",void 0),st(this,"_rootSelector",void 0),st(this,"_root",void 0),st(this,"_canvas",void 0),st(this,"_scope",void 0),st(this,"_rootItem",void 0),st(this,"_settings",void 0),st(this,"_fadeAnimation",void 0),st(this,"_trace",void 0),st(this,"_traceVisGroup",void 0),st(this,"_markingMode",!1),this._rootSelector=e,this._settings=new w(i),this._fadeAnimation=new W,this._trace=new Z(this._settings),this.inputActivation$=new h.a,this.inputDeactivation$=new h.a,this.inputPosition$=new h.a,this._dragging$=new h.a,this._click$=new h.a}var e,i,n;return e=t,(i=[{key:"init",value:function(){var t=document.querySelector(this._rootSelector);if(null===t)throw new Error("No element matching '".concat(this._rootSelector,"' found."));this._root=t,this.setupCanvas(),this.setupScope(),this.setupObservables(),void 0===window.PointerEvent?this.setupObservableDataFromInputEvents():this.setupObservableDataFromPointerEvents(),this._traceVisGroup=new f.Group}},{key:"display",value:function(){if(void 0===this._rootItem)throw new Error("Menu not initialized.");this._rootItem.state!==o.HIDDEN&&this._rootItem.state!==o.NONE||(this.trace$.reset(),this._traceVisGroup.removeChildren(),this._fadeAnimation.stop(),this._rootItem.visible=!0,this._fadeAnimation.start(),this._rootItem.state=o.ACTIVE,this._rootItem.redraw(),this._rootItem.position=this.inputPosition)}},{key:"setStructure",value:function(t){this._rootItem=t,this._rootItem.menu=this,this._rootItem.settings=this._settings,this._rootItem.init(),this._rootItem.visible=!1,this._fadeAnimation.initialize({target:this._rootItem,from:{opacity:0},to:{opacity:1},options:{duration:this._settings[c.MAIN].animationDuration,easing:"easeOutCubic"}})}},{key:"setupCanvas",value:function(){if(void 0===this._root)throw new Error("Root element '".concat(this._rootSelector,"' missing."));this._canvas=document.createElement("canvas"),this._canvas.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._canvas.setAttribute("data-paper-resize","true"),this._canvas.setAttribute("tabindex","1"),this._canvas.style["touch-action"]="none",this._root.appendChild(this._canvas)}},{key:"setupScope",value:function(){this._scope=new f.PaperScope,this._scope.settings.insertItems=!1,this._scope.settings.applyMatrix=!1,this._scope.activate(),this._scope.setup(this.canvas),this._scope.project.currentStyle=this._settings.projectStyle}},{key:"setupObservables",value:function(){var e=this;this.inputActivation$.pipe(Object(S.a)(function(t){return 1===t.buttons}),Object(I.a)(function(){return e.inputPosition$.pipe(Object(O.a)(function(t){return{position:t,state:a.DRAGGING}}),Object(A.a)(e.inputDeactivation$),Object(T.a)(function(){e._markingMode&&(e._markingMode=!1,e._dragging$.next({position:e.inputPosition,state:a.END}))}))})).subscribe(this._dragging$),this.inputActivation$.pipe(Object(G.a)(function(){return e.inputDeactivation$.pipe(Object(D.a)(t.INPUT_TIMEOUT,new u.a),Object(O.a)(function(t){return 0===t.button?s.LEFT_CLICK:s.RIGHT_CLICK}))})).subscribe(this._click$),this._dragging$.subscribe(function(t){e.display(),e._markingMode=t.state!==a.END,e._trace.update(t.position)}),this.inputPosition$.subscribe(function(t){e._inputPosition=t}),this._click$.subscribe(function(t){t===s.LEFT_CLICK&&e.display()})}},{key:"setupObservableDataFromPointerEvents",value:function(){var t=this.createObserver("pointermove"),e=Object(l.a)(this.createObserver("pointerup"),this.createObserver("pointercancel")),i=this.createObserver("pointerdown"),n=Object(l.a)(this.createObserver("pointerleave"),this.createObserver("pointerout"));i.subscribe(this.inputActivation$),e.subscribe(this.inputDeactivation$),n.subscribe(this.inputDeactivation$),t.pipe(Object(O.a)(function(t){return new f.Point(t.clientX,t.clientY)})).subscribe(this.inputPosition$)}},{key:"setupObservableDataFromInputEvents",value:function(){var t=this.createObserver("touchmove"),e=this.createObserver("touchend"),i=this.createObserver("touchdown"),n=this.createObserver("touchcancel"),o=this.createObserver("mousemove"),r=this.createObserver("mouseup"),s=this.createObserver("mousedown"),a=this.createObserver("mouseleave"),c=Object(l.a)(o,t),h=Object(l.a)(e,r),u=Object(l.a)(i,s),d=Object(l.a)(n,a);u.subscribe(this.inputActivation$),h.subscribe(this.inputDeactivation$),d.subscribe(this.inputDeactivation$),c.pipe(Object(O.a)(function(t){return new f.Point(t.clientX,t.clientY)})).subscribe(this.inputPosition$)}},{key:"createObserver",value:function(t){return Object(d.a)(this._canvas,t)}},{key:"drawTrace",value:function(){var t=this;if(void 0===this._traceVisGroup)throw new Error("Trace visualization group not initialized");if(void 0===this._scope)throw new Error("Scope not set");this._scope.project.activeLayer.addChild(this._traceVisGroup),this._trace.onDecisionPoint$.subscribe(function(e){var i=new f.Path.Circle(e,5);i.fillColor=ot.fromString("green"),t._traceVisGroup.addChild(i)}),this._dragging$.subscribe(function(e){var i=new f.Path.Circle(e.position,2);i.fillColor=ot.fromString("black"),t._traceVisGroup.addChild(i)})}},{key:"inputPosition",get:function(){return this._inputPosition}},{key:"click$",get:function(){if(void 0===this._click$)throw new Error("Menu not initialized");return this._click$.asObservable()}},{key:"dragging$",get:function(){if(void 0===this._dragging$)throw new Error("Menu not initialized");return this._dragging$.asObservable()}},{key:"selection$",get:function(){if(void 0===this._rootItem)throw new Error("Menu not initialized");return this._rootItem.selection$}},{key:"trace$",get:function(){return this._trace}},{key:"markingMode",get:function(){return this._markingMode}},{key:"canvas",get:function(){if(void 0===this._canvas)throw new Error("Canvas not initialized in menu");return this._canvas}}])&&rt(e.prototype,i),n&&rt(e,n),t}();st(at,"INPUT_TIMEOUT",200);var ct=i(4),ht=i(144);function ut(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var dt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"toDeg",value:function(e){return e*(t.HALF_CIRCLE_DEG/Math.PI)}},{key:"toRad",value:function(e){return e*(Math.PI/t.HALF_CIRCLE_DEG)}},{key:"difference",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Math.abs(t-e),o=2*Math.PI-Math.abs(t-e);return i?Math.max(n,o):Math.min(n,o)}},{key:"bisecting",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(e+Math.abs((i<e?t.HALF_CIRCLE_RAD:0)-Math.abs(e-i)/2))%t.FULL_CIRCLE_RAD;return n?t.toDeg(o):o}},{key:"opposite",value:function(t){return(Math.PI+t)%(2*Math.PI)}},{key:"toX",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=Math.sin(e);return Math.abs(n)<Number.EPSILON?0:t.normalizeNumber(n*i)}},{key:"toY",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=-Math.cos(e);return Math.abs(n)<Number.EPSILON?0:t.normalizeNumber(n*i)}},{key:"between",value:function(t,e,i){return i>e?t<i&&t>e:t>e||t<i}},{key:"normalizeNumber",value:function(t){return t<0?Math.ceil(t):Math.floor(t)}}],(i=null)&&ut(e.prototype,i),n&&ut(e,n),t}();function ft(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}lt(dt,"FULL_CIRCLE_DEG",360),lt(dt,"HALF_CIRCLE_DEG",dt.FULL_CIRCLE_DEG/2),lt(dt,"FULL_CIRCLE_RAD",2*Math.PI),lt(dt,"HALF_CIRCLE_RAD",dt.FULL_CIRCLE_RAD/2);var pt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"fromAngles",value:function(t){var e=new Array,i=new Array;return(t=t.sort(function(t,e){return t-e})).forEach(function(e,n){var o;o=0===n?t[t.length-1]:t[n-1];var r=dt.bisecting(o,e);i.push(r)}),i.forEach(function(n,o){var r;r=o===t.length-1?i[0]:i[o+1];var s=dt.bisecting(n,r);e.push({from:n,through:s,to:r,origAngle:t[o]})}),e}},{key:"fromDefinition",value:function(t,e){var i=function(t){return new f.Point(dt.toX(t,e.radii.arc),dt.toY(t,e.radii.arc))},n=i(t.from),o=i(t.through),r=i(t.to),s=new f.Path.Arc(n,o,r);s.add(R),s.data=t,s.strokeWidth=0,s.closed=!0;var a=ot.fromSettings(e.arc.color);return a instanceof f.Color?s.fillColor=a:(a.radial=e.arc.radial,s.fillColor=new f.Color(a,R,o)),s.opacity=0,s.data.fx=new W,s}},{key:"arcStroke",value:function(t,e,i){var n=new f.Path.Line(R,t);return n.strokeWidth=i.arc.stroke.width,n.scale(.5),n.strokeColor=void 0===i.arc.stroke.color?e:ot.fromString(i.arc.stroke.color),n}}],(i=null)&&ft(e.prototype,i),n&&ft(e,n),t}(),gt=i(61),vt=i(41);function bt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var yt=function(){function t(e,i,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),mt(this,"type",void 0),mt(this,"source",void 0),mt(this,"target",void 0),mt(this,"data",void 0),this.type=e,this.source={itemId:i.itemId,angle:dt.toDeg(i.angle)},this.data=o,void 0!==n&&(this.target={itemId:n.itemId,angle:dt.toDeg(n.angle)})}var e,i,n;return e=t,(i=[{key:"equals",value:function(t){if(void 0===t)return!1;t.type,this.type,t.source.itemId,this.source.itemId;return void 0===t.target||void 0===this.target||t.target.itemId===this.target.itemId&&t.target.angle===this.target.angle,!1}}])&&bt(e.prototype,i),n&&bt(e,n),t}();function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ct(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Et(t){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wt(t,e){return(wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function St(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var It=function(t){function e(t,i,n,r){var s,a,c,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),a=this,s=!(c=Et(e).call(this))||"object"!==_t(c)&&"function"!=typeof c?kt(a):c,St(kt(s),"itemId",void 0),St(kt(s),"textContent",void 0),St(kt(s),"angle",void 0),St(kt(s),"_iconName",void 0),St(kt(s),"isRoot",void 0),St(kt(s),"_state",o.NONE),St(kt(s),"_prevState",void 0),St(kt(s),"ready",!1),St(kt(s),"geometryGroup",void 0),St(kt(s),"arcGroup",void 0),St(kt(s),"lineGroup",void 0),St(kt(s),"arcs",void 0),St(kt(s),"_text",void 0),St(kt(s),"_geometry",void 0),St(kt(s),"_selectionRadius",void 0),St(kt(s),"_connector",void 0),St(kt(s),"_icon",void 0),St(kt(s),"back",!1),St(kt(s),"activeChild",void 0),St(kt(s),"hoveredChild",void 0),St(kt(s),"parentArc",void 0),St(kt(s),"subscription",void 0),St(kt(s),"_selectionSubject$",void 0),St(kt(s),"_selectionObservable$",void 0),St(kt(s),"_inputAngle$",void 0),St(kt(s),"_animations",void 0),St(kt(s),"_menu",void 0),St(kt(s),"_settings",void 0),St(kt(s),"_positionChild",void 0),St(kt(s),"_positionDot",void 0),St(kt(s),"_prevEvent",void 0),s.textContent=n,s.itemId=t,s.angle=dt.toRad(i%dt.FULL_CIRCLE_DEG),s.iconName=r,s.isRoot=u,s.geometryGroup=new f.Group,s.arcGroup=new f.Group,s.lineGroup=new f.Group,s.pivot=R,s.arcs=new Array,s._animations=new K,s._selectionSubject$=new h.a,s._selectionObservable$=s._selectionSubject$.asObservable(),s}var i,u,l;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(e,f["Group"]),i=e,(u=[{key:"init",value:function(){this.ready||(this.isRoot?this.project.activeLayer.addChild(this):this.parent.addChild(this),this._inputAngle$=this.menu.inputPosition$.pipe(Object(O.a)(this.angleToReferencePoint.bind(this)),Object(ht.a)(function(t,e){return Math.round(dt.toDeg(t))===Math.round(dt.toDeg(e))})),this._positionChild=new f.Point(dt.toX(this.angle,this.settings[c.RADII].child),dt.toY(this.angle,this.settings[c.RADII].child)).floor(),Object.freeze(this._positionChild),this._positionDot=new f.Point(dt.toX(this.angle,this.settings[c.RADII].dot),dt.toY(this.angle,this.settings[c.RADII].dot)).floor(),Object.freeze(this._positionDot),this._animations.duration=this.settings[c.MAIN].animationDuration,this.setupGroups(),this.setupConnector(),this.setupGeometry(),this.setupIcon(),this.setupText(),this.setupSelectionRadius(),this.afterSetup(),this.addChild(this.connector),this.addChild(this.geometryGroup),this.geometryGroup.addChild(this.arcGroup),this.geometryGroup.addChild(this.geometry),this.geometryGroup.addChild(this.selectionRadius),this.geometryGroup.addChild(this.icon),this.geometryGroup.addChild(this.text),this.geometryGroup.addChild(this.lineGroup),this.getChildren().forEach(function(t){t.init()}),this.collectArcAngles(),this.createArcs(),this.ready=!0,this.itemReady())}},{key:"redraw",value:function(){this.state!==this._prevState&&(void 0!==this._animations&&this.stopAnimations(),this.drawItem(),this.getChildren().forEach(function(t){t.redraw()}))}},{key:"stateChanged",value:function(){if(this.back=!1,this.geometryGroup.position=R,this.geometryGroup.visible=!0,this.geometry.fillColor=ot.fromString(this.settings[c.GEOMETRY].color),this.icon.visible=!0,this.icon.opacity=1,this.arcGroup.visible=!1,this.arcGroup.opacity=0,this.text.visible=!1,this.lineGroup.visible=!1,this.connector.visible=!1,this.selectionRadius.visible=!1,this.state===o.ACTIVE||this.state===o.ACTIVE_SELECTION?(this.addSubscriptions(),this.icon.opacity=e.ICON_BG_OPACITY,this.updateText(this.textContent)):(this.subscription&&this.subscription.unsubscribe(),this.arcGroup.children.forEach(function(t){t.opacity=0})),this.setGroupsVisibility(),this.state===o.HIDDEN){var t=this.parent,i=t.activeChild,n=!1,r=null!==t.parent&&t.parent.state===o.BACK,s=t.state===o.HIDDEN||t.state===o.DOT;void 0!==i&&(n=i.state===o.PARENT||i.state===o.SUBMENU),(s||n||r)&&(this.geometryGroup.visible=!1),this.reset()}this.state!==o.SUBMENU&&(this.connector.opacity=1,this.geometry.opacity=1,this.getChildren().forEach(function(t){t.geometry.opacity=1}))}},{key:"setGroupsVisibility",value:function(){switch(this.state){case o.ACTIVE:this.text.visible=!0,this.arcGroup.visible=!0,this.lineGroup.visible=!0,this.selectionRadius.visible=this.settings[c.MAIN].enableMaxClickRadius;break;case o.ACTIVE_SELECTION:this.text.visible=!0,this.arcGroup.visible=!0;break;case o.DOT:this.icon.visible=!1;break;case o.PARENT:this.connector.visible=!0;break;case o.HIDDEN:case o.BACK_CHILD:this.icon.visible=!1;break;case o.SUBMENU:this.connector.firstSegment.point=R,this.connector.lastSegment.point=R,this.connector.visible=!0;break;case o.SELECTED:this.text.visible=!0}}},{key:"addSubscriptions",value:function(){this.subscription=new ct.a,this.subscription.add(this.inputAngle$.subscribe(this.selectionLogic.bind(this))),this.subscription.add(this.menu.click$.subscribe(this.clickLogic.bind(this))),this.subscription.add(this.menu.trace$.onDecisionPoint$.subscribe(this.traceLogic.bind(this))),this.subscription.add(this.menu.dragging$.subscribe(this.dragLogic.bind(this)))}},{key:"setupGroups",value:function(){this.geometryGroup.name=n.GEOMETRY,this.geometryGroup.pivot=R,this.geometryGroup.applyMatrix=!1,this.arcGroup.name=n.ARC}},{key:"setupConnector",value:function(){this._connector=new f.Path.Line(R,R),this.connector.strokeColor=ot.fromString(this.settings[c.CONNECTOR].color),this.connector.strokeWidth=this.settings[c.CONNECTOR].width,this.connector.strokeCap="round",this.connector.name=n.CONNECTOR,this.connector.visible=!1}},{key:"setupGeometry",value:function(){this._geometry=new f.Path.Circle(R,this.settings[c.GEOMETRY].size),this.geometry.fillColor=ot.fromString(this.settings[c.GEOMETRY].color),this.geometry.strokeScaling=!1}},{key:"setupIcon",value:function(){if(void 0===this.iconName)this._icon=new f.CompoundPath("");else{var t=gt[this._iconName];void 0===t?(console.error("Icon '".concat(this.iconName,"' does not exist.")),this._icon=new f.CompoundPath("")):(this._icon=new f.CompoundPath(t.icon[4]),this.icon.scale(this.settings[c.SCALES].icon.base*this.settings[c.SCALES].icon.solo),this.icon.fillColor=ot.fromString(this.settings[c.GEOMETRY].icon.color),this.icon.strokeWidth=0,this.icon.position=R)}}},{key:"setupText",value:function(){this._text=new f.PointText(R.clone()),this.text.justification="center",this.text.fontSize="16px",this.text.fontWeight="bold",this.text.fillColor=ot.fromString(this.settings[c.GEOMETRY].text.color),this.text.strokeWidth=0,this.updateText(this.textContent||""),this.text.position=R}},{key:"setupSelectionRadius",value:function(){this._selectionRadius=new f.Path.Circle(R,this.settings[c.RADII].maxClickRadius),this.selectionRadius.fillColor=null,this.selectionRadius.strokeWidth=1,this.selectionRadius.strokeColor=ot.fromString(this.settings[c.GEOMETRY].color),this.selectionRadius.strokeColor.alpha=.25,this.selectionRadius.visible=!1}},{key:"getChildren",value:function(){return this.children.filter(function(t){return t instanceof e})}},{key:"getNearestChild",value:function(t){return this.getChildren().reduce(function(e,i){return Math.abs(dt.difference(e.angle,t))>Math.abs(dt.difference(i.angle,t))?i:e})}},{key:"updateText",value:function(t){t!==this.text.content&&(this.text.scaling=N,this.text.content=t,this.text.bounds.size.width+10>this.geometry.bounds.size.width&&this.text.fitBounds(this.geometry.bounds.scale(e.TEXT_OVERFLOW_SCALE)))}},{key:"angleToReferencePoint",value:function(t){var e=L.getDirectedAngle(this.globalToLocal(t));return e<0&&(e+=dt.FULL_CIRCLE_DEG),dt.toRad(e)}},{key:"navigateBack",value:function(){this.parent instanceof e&&(this.menu.trace$.reset(),this.resetActiveHovered(),this.event(r.BACK,this.parent),this.parent.state=o.ACTIVE,this.state=o.BACK,this.connector.strokeWidth=this.settings[c.CONNECTOR].width,this.connector.strokeColor=ot.fromString(this.settings[c.CONNECTOR].color),this.root.redraw())}},{key:"changeActive",value:function(){this.state===o.ACTIVE&&(this.activeChild=this.getNearestChild(this.angleToReferencePoint(this.menu.inputPosition)),this.state=o.SUBMENU,this.menu.trace$.reset(),this.activeChild.isLeaf?this.menu.markingMode?(this.activeChild.state=o.ACTIVE_SELECTION,this.event(r.HOVER_SELECTION,this.activeChild)):(this.activeChild.state=o.SELECTED,this.event(r.SELECTION,this.activeChild)):(this.activeChild.state=o.ACTIVE,this.event(r.SUBMENU,this.activeChild)),this.root.redraw())}},{key:"event",value:function(t,e,i){var n=new yt(t,this,e,i);void 0!==this._prevEvent&&n.equals(this._prevEvent)||this.root._selectionSubject$.next(n),this._prevEvent=n}},{key:"reset",value:function(){this.resetActiveHovered(),this._prevEvent=void 0,this._prevState=void 0,this.geometryGroup.position=R,this.arcGroup.children.forEach(function(t){t.opacity=0}),this.connector.visible=!1,this.connector.firstSegment.point=R,this.connector.lastSegment.point=R,this.connector.strokeColor=ot.fromString(this.settings[c.CONNECTOR].color),this.connector.strokeWidth=this.settings[c.CONNECTOR].width,this.getChildren().forEach(function(t){return t.reset()})}},{key:"stopAnimations",value:function(){this._animations.stop(),this._animations.reset(),this._animations.easing="easeOutCubic"}},{key:"resetActiveHovered",value:function(){this.activeChild=void 0,this.hoveredChild=void 0}},{key:"collectArcAngles",value:function(){var t,e=new Array,i=dt.opposite(this.angle);this.isRoot||e.push(i),this.getChildren().forEach(function(t){e.push(t.angle)}),1===e.length&&(t=dt.opposite(e[0]),e.push(t)),this.arcs=pt.fromAngles(e),this.isRoot||(this.parentArc=this.arcs.find(function(t){return t.origAngle===i}))}},{key:"createArcs",value:function(){var t=this;this.arcs.forEach(function(e){var i=pt.fromDefinition(e,t.settings);t.arcGroup.addChild(i),t.settings[c.ARC].stroke.enabled&&t.lineGroup.addChild(pt.arcStroke(i.firstSegment.point,i.fillColor,t.settings))})}},{key:"resetChildColor",value:function(){var t=this;this.getChildren().forEach(function(e){e.geometry.fillColor=ot.fromString(t.settings[c.GEOMETRY].color),e.getChildren().forEach(function(e){e.geometry.fillColor=ot.fromString(t.settings[c.GEOMETRY].color)})})}},{key:"selectionLogic",value:function(t){var e=R.getDistance(this.globalToLocal(this.menu.inputPosition));if(e>=this.settings[c.RADII].maxClickRadius&&this.settings[c.MAIN].enableMaxClickRadius)return this.resetChildColor(),void this.arcGroup.children.forEach(function(t){void 0!==t.data.fx&&t.data.fx.running&&t.data.fx.stop(),t.opacity=0});if(this.isRoot||(this.back=dt.between(t,this.parentArc.from,this.parentArc.to)),e<this.settings[c.GEOMETRY].size/2)this.selectionLogicInGeometryOperations();else{if(this.back)this.resetActiveHovered(),this.selectionLogicBackOperations();else{if(this.isLeaf)return;var i=this.getNearestChild(t);if(this.hoveredChild===i)return;this.selectionLogicHoverOperations(i)}this.animateArcs(t)}}},{key:"selectionLogicInGeometryOperations",value:function(){this.resetActiveHovered(),this.arcGroup.children.forEach(function(t){t.opacity=0}),this.updateText(this.textContent),this.resetChildColor()}},{key:"selectionLogicBackOperations",value:function(){this.resetChildColor(),this.event(r.BACK_HOVER,this.parent),this.updateText("Back")}},{key:"selectionLogicHoverOperations",value:function(t){var e=this;this.resetChildColor(),this.hoveredChild=t,this.hoveredChild.geometry.fillColor=ot.fromString(this.settings[c.GEOMETRY].selectionColor),this.hoveredChild.getChildren().forEach(function(t){t.geometry.fillColor=ot.fromString(e.settings[c.GEOMETRY].selectionColor)}),this.hoveredChild.isLeaf?this.event(r.HOVER_SELECTION,this.hoveredChild):this.event(r.HOVER,this.hoveredChild),this.updateText(this.hoveredChild.textContent)}},{key:"clickLogic",value:function(t){if(R.getDistance(this.globalToLocal(this.menu.inputPosition))>=this.settings[c.RADII].maxClickRadius&&this.settings[c.MAIN].enableMaxClickRadius)return this.root.state=o.HIDDEN,void this.root.redraw();t!==s.RIGHT_CLICK?this.back?this.navigateBack():void 0!==this.hoveredChild&&this.changeActive():this.isRoot?(this.root.state=o.HIDDEN,this.root.visible=!1):this.navigateBack()}},{key:"traceLogic",value:function(t){var e=this.angleToReferencePoint(t),i=this.globalToLocal(t);if(!this.isRoot&&this.back&&R.getDistance(i)>=this.settings[c.MAIN].minTraceDistance)return this.connector.visible=!1,void this.navigateBack();this.isLeaf||(this.hoveredChild=this.getNearestChild(e),this.hoveredChild.position=i,this.changeActive())}},{key:"dragLogic",value:function(t){this.connector.visible=!1;var e=this.globalToLocal(t.position);if(this.isLeaf)t.state===a.END&&(this.menu.trace$.reset(),this.state=o.SELECTED,this.event(r.SELECTION,this),this.root.redraw());else if(t.state===a.END&&e.getDistance(R)>this.settings[c.MAIN].minTraceDistance)this.changeActive();else{var i=this.getNearestChild(this.angleToReferencePoint(t.position));R.getDistance(e)>=this.settings[c.MAIN].minTraceDistance&&!this.back?(i.stopAnimations(),i.position=e,this.connector.visible=!0,this.connector.lastSegment.point=e):i.position=i.positionChild,this.getChildren().filter(function(t){return t!==i}).forEach(function(t){t.position=t.positionChild})}}},{key:"drawItem",value:function(){switch(this.state){case o.HIDDEN:this.animateStateHidden();break;case o.ACTIVE:this.animateStateActive();break;case o.ACTIVE_SELECTION:this.animateStateActiveSelection();break;case o.CHILD:this.animateStateChild();break;case o.PARENT:this.animateStateParent();break;case o.DOT:this.animateStateDot();break;case o.BACK:this.animateStateBack();break;case o.BACK_CHILD:this.animateStateBackChild();break;case o.SUBMENU:this.animateStateSubmenu();break;case o.SELECTED:this.animateStateSelected()}this._animations.start()}},{key:"toString",value:function(){var t="None";return this.parent instanceof e&&(t=this.parent.itemId),"".concat(this.itemId," (").concat(dt.toDeg(this.angle),"Â°) | Parent: ").concat(t," | Root: ").concat(this.isRoot," | Pos: ").concat(this.position," | State: ").concat(this.state," | Children: ").concat(this.getChildren().length)}},{key:"animateStateHidden",value:function(){if(this.parent.state!==o.HIDDEN&&this.parent.state!==o.DOT){var t={scaling:0,position:R.subtract(this.position).add(this.position.multiply(this.settings[c.SCALES].dot))};this._animations.push(new W({target:this.geometryGroup,to:t}))}}},{key:"animateStateActive",value:function(){var t=this;this._animations.push(new W({target:this.geometryGroup,from:{scaling:this.settings[c.SCALES].parent},to:{scaling:1}})),this._animations.onFinish$.subscribe(function(){new W({target:t.arcGroup,from:{opacity:0},to:{opacity:1},options:{duration:t.settings[c.MAIN].animationDuration}}).start()})}},{key:"animateStateChild",value:function(){this.geometryGroup.position=R,this._animations.push(new W({target:this,from:{position:this.positionChild.normalize(this.settings[c.RADII].dot)},to:{position:this.positionChild}}),new W({target:this.geometryGroup,from:{scaling:this.settings[c.SCALES].dot},to:{scaling:this.settings[c.SCALES].child}}))}},{key:"animateStateParent",value:function(){this.parent.state,o.PARENT,this._animations.push(new W({target:this.geometryGroup,to:{scaling:this.settings[c.SCALES].parent}}))}},{key:"animateStateDot",value:function(){this.parent.state,o.CHILD,this.parent.state!==o.PARENT?this._animations.push(new W({target:this,from:{position:this.parent.position},to:{position:this.positionDot}}),new W({target:this.geometryGroup,from:{position:R.subtract(this.parent.position),scaling:0},to:{position:R,scaling:this.settings[c.SCALES].dot}})):this._animations.push(new W({target:this,from:{position:this.position},to:{position:this.positionDot}}),new W({target:this.geometryGroup,to:{scaling:this.settings[c.SCALES].dot}}))}},{key:"animateStateBack",value:function(){var t=this;this._state=o.CHILD;var e=this.parent,i=this.menu.inputPosition;e.isRoot||(i=this.root.position.add(e.globalToLocal(this.menu.inputPosition)).floor(),this.parent.parent.connector.strokeWidth=this.settings[c.CONNECTOR].width,this.parent.parent.connector.strokeColor=ot.fromString(this.settings[c.CONNECTOR].color),this.parent.parent.geometry.opacity=1,this.parent.parent.getChildren().forEach(function(t){t.geometry.opacity=1})),this._animations.easing="easeInCubic",this._animations.push(new W({target:this.root,to:{position:i}}),new W({target:this,to:{position:this.positionChild}}),new W({target:e.connector,to:{"lastSegment.point":R}}),new W({target:this.geometryGroup,to:{scaling:this.settings[c.SCALES].child}})),this._animations.onStop$.subscribe(function(){e.connector.lastSegment.point=R,e.connector.strokeColor=ot.fromString(t.settings[c.CONNECTOR].color),e.connector.strokeWidth=t.settings[c.CONNECTOR].width}),this._animations.onFinish$.subscribe(function(){e.connector.visible=!1,e.connector.strokeColor=ot.fromString(t.settings[c.CONNECTOR].color),e.connector.strokeWidth=t.settings[c.CONNECTOR].width})}},{key:"animateStateBackChild",value:function(){this._state=o.DOT,this._animations.push(new W({target:this,to:{position:this.position.normalize(this.settings[c.RADII].dot)}}),new W({target:this.geometryGroup,to:{scaling:this.settings[c.SCALES].dot}}))}},{key:"animateStateSubmenu",value:function(){var t=this;this._state=o.PARENT;var i=this.globalToLocal(this.menu.inputPosition).floor(),n=this.activeChild;if(void 0===n)throw new Error("State is missing active Child");n.bringToFront();var r=L.clone();r.angleInRadians=n.angle-dt.HALF_CIRCLE_RAD/2,r.x=Math.abs(r.x)<Number.EPSILON?0:r.x,r.y=Math.abs(r.y)<Number.EPSILON?0:r.y,r.length=i.multiply(r).length,r.length<this.settings[c.MAIN].minDistance&&(r.length=this.settings[c.MAIN].minDistance);var s=i.subtract(r);this._animations.push(new W({target:this.root,to:{position:this.root.position.add(s).floor()}}),new W({target:n,from:{position:n.position},to:{position:r}}),new W({target:this.connector,to:{"lastSegment.point":r}}),new W({target:this.geometryGroup,to:{scaling:this.settings[c.SCALES].parent}})),this._animations.onStop$.subscribe(function(){t.connector.lastSegment.point=r}),this.state===o.PARENT&&void 0!==this.activeChild&&this.parent instanceof e&&(this.parent.connector.strokeWidth=2,this.parent.connector.strokeColor=ot.fromString("rgba(57,58,60,0.2)"),this.parent.geometry.opacity=.25,this.parent.getChildren().filter(function(e){return e!==t}).forEach(function(t){t.geometry.opacity=.25}))}},{key:"animateStateSelected",value:function(){var t=this;this.geometry.fillColor=ot.fromString(this.settings[c.GEOMETRY].selectionColor),this.icon.opacity=e.ICON_BG_OPACITY,this._animations.push(new W({target:this.geometryGroup,from:{scaling:this.settings[c.SCALES].child},to:{scaling:1}})),this._animations.onFinish$.subscribe(function(){t.root.state=o.HIDDEN,t.root.visible=!1})}},{key:"animateStateActiveSelection",value:function(){var t=this;this.geometry.fillColor=ot.fromString(this.settings[c.GEOMETRY].selectionColor),this._animations.push(new W({target:this.geometryGroup,from:{scaling:this.settings[c.SCALES].child},to:{scaling:1}})),this._animations.onFinish$.subscribe(function(){new W({target:t.arcGroup,from:{opacity:0},to:{opacity:1},options:{duration:t.settings[c.MAIN].animationDuration}}).start()})}},{key:"animateArcs",value:function(t){var e=this;this.arcGroup.children.forEach(function(i){dt.between(t,i.data.from,i.data.to)&&(e.arcGroup.children.filter(function(t){return t!==i}).forEach(function(t){void 0!==t.data.fx&&t.data.fx.running&&t.data.fx.stop(),t.opacity=0}),i.opacity<1&&!i.data.fx.running&&(i.data.fx.initialize({target:i,to:{opacity:1},options:{duration:e.settings[c.MAIN].animationDuration,easing:"easeInCubic"}}),i.data.fx.start()))})}},{key:"itemReady",value:function(){}},{key:"afterSetup",value:function(){}},{key:"selection$",get:function(){return this._selectionObservable$}},{key:"menu",get:function(){if(void 0===this.root._menu)throw new Error("Events object missing on root");return this.root._menu},set:function(t){if(!this.isRoot)throw new Error("Events can only be set on root");this._menu=t}},{key:"settings",get:function(){if(void 0===this.root._settings)throw new Error("Settings object missing on root");return this.root._settings},set:function(t){if(!this.isRoot)throw new Error("Settings can only be set on root");this._settings=t}},{key:"state",get:function(){return this._state},set:function(t){if(this._state!==t){var e;switch(this._prevState=this._state,this._state=t,t){case o.HIDDEN:e=o.HIDDEN;break;case o.ACTIVE:e=o.CHILD;break;case o.CHILD:e=o.DOT;break;case o.DOT:e=o.HIDDEN;break;case o.BACK:e=o.BACK_CHILD;break;case o.BACK_CHILD:e=o.HIDDEN;break;case o.SUBMENU:e=o.DOT;break;default:e=o.NONE}e!==o.NONE&&this.getChildren().forEach(function(t){t.state=e}),this.stateChanged()}}},{key:"isLeaf",get:function(){return 0===this.getChildren().length}},{key:"childCount",get:function(){return this.getChildren().reduce(function(t,e){return e.getChildren().length>0?t+e.childCount:t},this.getChildren().length)}},{key:"iconName",set:function(t){void 0!==t&&(this._iconName="fa".concat(Object(vt.upperFirst)(Object(vt.camelCase)(t))))},get:function(){return this._iconName}},{key:"connector",get:function(){if(void 0===this._connector)throw new Error("Connector missing on ".concat(this.itemId));return this._connector}},{key:"inputAngle$",get:function(){if(void 0===this._inputAngle$)throw new Error("Mouse angle observable not initialized on ".concat(this.itemId));return this._inputAngle$}},{key:"root",get:function(){return this.isRoot?this:this.parent.root}},{key:"geometry",get:function(){if(void 0===this._geometry)throw new Error("Geometry missing on ".concat(this.itemId));return this._geometry}},{key:"icon",get:function(){if(void 0===this._icon)throw new Error("Icon missing on ".concat(this.itemId));return this._icon}},{key:"text",get:function(){if(void 0===this._text)throw new Error("Text missing on ".concat(this.itemId));return this._text}},{key:"positionChild",get:function(){if(void 0===this._positionChild)throw new Error("Child Position missing on ".concat(this.itemId));return this._positionChild}},{key:"positionDot",get:function(){if(void 0===this._positionDot)throw new Error("Dot Position missing on ".concat(this.itemId));return this._positionDot}},{key:"selectionRadius",get:function(){if(void 0===this._selectionRadius)throw new Error("Selection Radius not initialized on ".concat(this.itemId));return this._selectionRadius}}])&&Ct(i.prototype,u),l&&Ct(i,l),e}();function Ot(t){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function At(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Gt(t,e,i){return(Gt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Dt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function Dt(t){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rt(t,e){return(Rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}St(It,"ICON_BG_OPACITY",.4),St(It,"TEXT_OVERFLOW_SCALE",.8);var Nt=function(t){function e(t,i,n,r){var s,a,h;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),a=this,h=Dt(e).call(this,t,i,n,r),s=!h||"object"!==Ot(h)&&"function"!=typeof h?Tt(a):h,Lt(Tt(s),"STEP_SIZE",1),Lt(Tt(s),"valueGroup",void 0),Lt(Tt(s),"indicator",void 0),Lt(Tt(s),"indicatorDot",void 0),document.querySelector("body").addEventListener("wheel",function(t){s.geometryGroup.rotate(1*Math.sign(t.deltaY)),s.updateText(),s.text.rotation=-s.geometryGroup.rotation,s.valueGroup.rotation=-s.geometryGroup.rotation}),document.querySelector("body").addEventListener("dblclick",function(t){var e=new f.Point(t.clientX,t.clientY);s.state===o.ACTIVE&&R.getDistance(s.globalToLocal(e))<=s.settings[c.GEOMETRY].size&&s.navigateBack()}),s}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rt(t,e)}(e,It),i=e,(n=[{key:"setupGeometry",value:function(){Gt(Dt(e.prototype),"setupGeometry",this).call(this),this.indicator=new f.Path.Line(this.geometry.bounds.topCenter,this.geometry.bounds.topCenter.multiply(1.25)),this.indicator.strokeWidth=2,this.geometryGroup.addChild(this.indicator),this.valueGroup=new f.Group,this.valueGroup.pivot=R;for(var t=0;t<2*dt.HALF_CIRCLE_RAD;t+=dt.HALF_CIRCLE_RAD/2){var i=new f.Point(dt.toX(t,90),dt.toY(t,90)),n=new f.PointText(i);n.content=dt.toDeg(t).toString(),n.justification="center",n.strokeWidth=0,n.fontWeight="bold",n.bounds.center=i,this.valueGroup.addChild(n)}for(var o=0;o<2*dt.HALF_CIRCLE_RAD;o+=dt.HALF_CIRCLE_RAD/8){var r=void 0;r=dt.toDeg(o)%dt.toDeg(dt.HALF_CIRCLE_RAD/4)==0?75:70;var s=new f.Path.Line(new f.Point(dt.toX(o,65),dt.toY(o,65)),new f.Point(dt.toX(o,r),dt.toY(o,r)));s.strokeWidth=1,this.valueGroup.addChild(s)}this.geometryGroup.addChild(this.valueGroup),this.indicatorDot=new f.Path.Circle(this.geometry.bounds.topCenter,5),this.indicatorDot.visible=!1,this.geometryGroup.addChild(this.indicatorDot)}},{key:"getNearestChild",value:function(){return this}},{key:"navigateBack",value:function(){this.parent.connector.strokeColor=ot.fromString("#393a3c"),this.parent.connector.strokeWidth=10,Gt(Dt(e.prototype),"navigateBack",this).call(this)}},{key:"setGroupsVisibility",value:function(){Gt(Dt(e.prototype),"setGroupsVisibility",this).call(this),this.lineGroup.visible=!1,this.arcGroup.visible=!1,this.text.visible=!0,this.icon.opacity=It.ICON_BG_OPACITY,this.valueGroup.visible=this.state===o.ACTIVE,this.indicator.visible=this.state===o.ACTIVE,this.indicatorDot.visible=this.state===o.ACTIVE,this.state===o.DOT&&(this.text.visible=!1)}},{key:"updateText",value:function(){var t=Math.round((this.geometryGroup.rotation+dt.FULL_CIRCLE_DEG)%dt.FULL_CIRCLE_DEG);Gt(Dt(e.prototype),"updateText",this).call(this,t+"")}},{key:"dragLogic",value:function(t){this.geometryGroup.rotation=-this.globalToLocal(t.position).getDirectedAngle(L)/1,this.updateText(),this.text.rotation=-this.geometryGroup.rotation,this.valueGroup.rotation=-this.geometryGroup.rotation,this.indicatorDot.rotation=-this.geometryGroup.rotation,this.connector.visible=t.state!==a.END,this.connector.lastSegment.point=this.globalToLocal(t.position),this.connector.strokeWidth=2,this.indicatorDot.position.length=R.getDistance(this.globalToLocal(t.position)),t.state===a.END&&(this.indicatorDot.position.length=this.geometry.bounds.topCenter.getDistance(R))}},{key:"traceLogic",value:function(){}},{key:"clickLogic",value:function(t){var e=this.globalToLocal(this.menu.inputPosition);if(t===s.RIGHT_CLICK)this.navigateBack();else if(R.getDistance(e)>=this.settings[c.GEOMETRY].size){this.geometryGroup.rotation=-this.globalToLocal(this.menu.inputPosition).getDirectedAngle(L)/1,this.updateText(),this.text.rotation=-this.geometryGroup.rotation,this.valueGroup.rotation=-this.geometryGroup.rotation,this.connector.lastSegment.point=this.globalToLocal(this.menu.inputPosition),this.connector.strokeWidth=2}}},{key:"animateStateBack",value:function(){Gt(Dt(e.prototype),"animateStateBack",this).call(this),this._animations.remove(this.root),this._animations.push(new W({target:this.geometry,to:{scaling:new f.Point(1,1)}}))}},{key:"animateStateActive",value:function(){Gt(Dt(e.prototype),"animateStateActive",this).call(this),this.parent.connector.strokeWidth=2,this.parent.connector.strokeColor=ot.fromString("rgba(57,58,60,0.2)")}},{key:"isLeaf",get:function(){return!1}}])&&At(i.prototype,n),r&&At(i,r),e}(),Pt=i(62),Mt=i.n(Pt);function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function jt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ht(t,e,i){return(Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ut(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Ft=function(t){function e(t,i,n,o){var r,s,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s=this,a=Ut(e).call(this,t,i,n,o),r=!a||"object"!==xt(a)&&"function"!=typeof a?jt(s):a,zt(jt(r),"_ribbonGroup",void 0),zt(jt(r),"_ribbon",void 0),zt(jt(r),"_gradient",void 0),zt(jt(r),"_grabDot",void 0),zt(jt(r),"_ribbonMaskGroup",void 0),zt(jt(r),"_configuration",void 0),zt(jt(r),"_value",0),zt(jt(r),"hasLock",!1),zt(jt(r),"pointerLockListener",function(t){if(0!=t.movementX){var e=r.configuration.min-r.ribbonGroup.position.x/r.configuration.stepDist*r.configuration.stepSize,i=function(t){for(var e=1;Math.round(t*e)/e!==t;)e*=10;return Math.log(e)/Math.LN10}(r.configuration.stepSize);r.value=0===i?Math.round(e):function(t,e){if((""+t).includes("e")){var i=(""+t).split("e"),n="";return+i[1]+e>0&&(n="+"),+(Math.round(Number(+i[0]+"e"+n+(+i[1]+e)))+"e-"+e)}return+(Math.round(Number(t+"e+"+e))+"e-"+e)}(e,i),r.updateRibbonPosition(t.movementX)}}),zt(jt(r),"throttledTextUpdate",Mt()(r.updateText,16,{leading:!0})),r}var i,n,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bt(t,e)}(e,It),i=e,(n=[{key:"moveRibbonToValuePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>this.configuration.max||t<this.configuration.min)throw RangeError("Slider (".concat(this.itemId,"): 'value' out of slider range"));var i=-this.configuration.stepDist*((t-this.configuration.min)/this.configuration.stepSize);e?new W({target:this.ribbonGroup,to:{"position.x":i},options:{duration:this.settings[c.MAIN].animationDuration,easing:"easeInCubic"}}).start():this.ribbonGroup.position.x=i,this.event(r.SLIDER_VALUE_CHANGED,this,{value:t})}},{key:"afterSetup",value:function(){this.setupGrabDotSymbol(),this.setupGradient(),this.setupRibbon()}},{key:"getNearestChild",value:function(){return this.hoveredChild=this,this}},{key:"traceLogic",value:function(){}},{key:"dragLogic",value:function(t){this.hasLock||(this.menu.canvas.requestPointerLock(),this.ribbon.fillColor=ot.fromString(this.settings[c.GEOMETRY].selectionColor),document.addEventListener("mousemove",this.pointerLockListener),this.hasLock=!0),t.state===a.END&&this.hasLock&&(document.exitPointerLock(),this.ribbon.fillColor=ot.fromString(this.settings[c.GEOMETRY].color),document.removeEventListener("mousemove",this.pointerLockListener),this.moveRibbonToValuePosition(this.value,!0),this.hasLock=!1)}},{key:"clickLogic",value:function(t){this.hoveredChild=void 0,t===s.RIGHT_CLICK&&Ht(Ut(e.prototype),"clickLogic",this).call(this,t)}},{key:"setGroupsVisibility",value:function(){Ht(Ut(e.prototype),"setGroupsVisibility",this).call(this),this.lineGroup.visible=!1,this.arcGroup.visible=!1,this.text.visible=!0,this.icon.opacity=0,this.state===o.DOT&&(this.text.visible=!1)}},{key:"animateStateActive",value:function(){Ht(Ut(e.prototype),"animateStateActive",this).call(this),this.geometry.fillColor=ot.fromString(this.settings[c.GEOMETRY].color)}},{key:"selectionLogicBackOperations",value:function(){}},{key:"itemReady",value:function(){this._ribbonMaskGroup=new f.Group({children:[this.createMask(),this.ribbonGroup],blendMode:"source-over"}),this.geometryGroup.addChild(this.ribbonMaskGroup),this.geometryGroup.addChild(this.gradient),this.text.bringToFront(),this.text.fontSize="20px",this.value=this.configuration.initial,this.moveRibbonToValuePosition(this.value),this.ribbonMaskGroup.addChild(this.createIndicatorCaret())}},{key:"stateChanged",value:function(){Ht(Ut(e.prototype),"stateChanged",this).call(this),this.state===o.ACTIVE?(this.updateText(""+this.value),this.moveRibbonToValuePosition(this.value),this.ribbonMaskGroup.visible=!0,this.gradient.visible=!0):(this.ribbonMaskGroup.visible=!1,this.gradient.visible=!1)}},{key:"selectionLogicInGeometryOperations",value:function(){}},{key:"getChildren",value:function(){return[]}},{key:"setupRibbon",value:function(){var t=this;this._ribbonGroup=new f.Group({blendMode:"source-in"}),this._ribbon=new f.Path.Rectangle(R,new f.Point(this.getRibbonLength()+e.GRADIENT_LENGTH,e.RIBBON_HEIGHT)),this.ribbonGroup.addChild(this.ribbon),this.ribbonGroup.pivot=this.ribbonGroup.bounds.leftCenter.add(new f.Point(e.GRADIENT_LENGTH/2,0)),this.ribbonGroup.position=R,this.ribbon.onMouseEnter=function(){t.menu.canvas.style.cursor="ew-resize"},this.ribbon.onMouseLeave=function(){t.menu.canvas.style.cursor="default"},this.setupRibbonContent()}},{key:"setupRibbonContent",value:function(){for(var t=this,i=function(e){t.hasLock||(e.target.fillColor=ot.fromString(t.settings[c.GEOMETRY].selectionColor),t.menu.canvas.style.cursor="pointer")},n=function(){t.menu.canvas.style.cursor="ew-resize"},o=function(i){t.updateRibbonPosition(-(i.target.position.x+t.ribbonGroup.position.x-e.GRADIENT_LENGTH/2),!0),t.value=i.target.data.value},r=0;r<=this.getRibbonLength()/(this.configuration.stepDist/2);r++)if(r%2==0){var s=this.text.clone(),a=Math.round(100*(this.configuration.min+r*this.configuration.stepSize/2))/100;s.position=new f.Point(r*(this.configuration.stepDist/2)+e.GRADIENT_LENGTH/2,e.RIBBON_HEIGHT/2),s.content=""+a,s.data.value=a,s.onMouseEnter=i,s.onMouseLeave=function(e){t.menu.canvas.style.cursor="default",e.target.fillColor=ot.fromString(t.settings[c.GEOMETRY].text.color)},s.onClick=o,this.ribbonGroup.addChild(s)}else{var h=this.grabDot.place(new f.Point(r*(this.configuration.stepDist/2)+e.GRADIENT_LENGTH/2,e.RIBBON_HEIGHT/2));h.onMouseEnter=n,this.ribbonGroup.addChild(h)}}},{key:"setupGradient",value:function(){this._gradient=new f.Path.Rectangle(R,new f.Point(e.GRADIENT_LENGTH,e.RIBBON_HEIGHT)),this.gradient.bounds.center=R,this.gradient.strokeWidth=0;var t=ot.fromArray(["rgba(32, 32, 32, 0)",[this.settings[c.GEOMETRY].stroke.color,.3],[this.settings[c.GEOMETRY].stroke.color,.7],"rgba(32, 32, 32, 0)"]);this.gradient.fillColor=new f.Color(t,this.gradient.bounds.leftCenter,this.gradient.bounds.rightCenter)}},{key:"setupGrabDotSymbol",value:function(){var t=new f.Group,e=Array(),i=new f.Path.Circle(R,3);i.fillColor=ot.fromString(this.settings[c.GEOMETRY].stroke.color),i.strokeWidth=0;for(var n=0;n<3;n++){for(var o=0;o<2;o++){var r=i.clone();r.position=R.add(new f.Point(10*o,10*n)),e.push(r)}t.addChildren(e),e.length=0}t.pivot=t.bounds.center,this._grabDot=new f.SymbolDefinition(t)}},{key:"createMask",value:function(){var t=new f.Path.Rectangle(R,new f.Point(this.menu.canvas.width*e.MASK_LENGTH_MULTIPLIER,e.RIBBON_HEIGHT+2));t.bounds.center=R,t.strokeWidth=0;var i=ot.fromArray(["rgba(0, 0, 0, 0)",["#000",.1],["#000",.9],"rgba(0, 0, 0, 0)"]);return t.fillColor=new f.Color(i,t.bounds.leftCenter,t.bounds.rightCenter),t}},{key:"createIndicatorCaret",value:function(){var t=new f.Path.RegularPolygon(R,3,10);return t.pivot=t.bounds.bottomCenter,t.rotate(dt.toDeg(Math.PI)),t.segments[1].point=t.segments[1].point.add(new f.Point(0,3)),t.strokeWidth=0,t.fillColor=ot.fromString(this.settings[c.GEOMETRY].stroke.color),t.position=this.geometry.bounds.topCenter.add(new f.Point(0,1)),t}},{key:"getRibbonLength",value:function(){return(this.configuration.max-this.configuration.min)/this.configuration.stepSize*this.configuration.stepDist}},{key:"updateRibbonPosition",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;t>0?n=this.ribbonGroup.bounds.leftCenter.x+e.GRADIENT_LENGTH/2+t<=0?this.ribbonGroup.position.x+t:0:t<0&&(n=this.ribbonGroup.bounds.rightCenter.x-e.GRADIENT_LENGTH/2+t>=0?this.ribbonGroup.position.x+t:-this.getRibbonLength()),i?new W({target:this.ribbonGroup,to:{"position.x":n},options:{duration:this.settings[c.MAIN].animationDuration,easing:"easeOutCubic"}}).start():this.ribbonGroup.position.x=n,this.event(r.SLIDER_VALUE_CHANGED,this,{value:this.value})}},{key:"isLeaf",get:function(){return!1}},{key:"configuration",get:function(){if(void 0===this._configuration)throw new Error("Slider (".concat(this.itemId,"): configuration not set"));return this._configuration}},{key:"data",set:function(t){var e=xt(t.min),i=xt(t.max),n=xt(t.initial),o=xt(t.stepSize),r=xt(t.stepDist);if("undefined"===e||"undefined"===i)throw new Error("Slider (".concat(this.itemId,"): configuration is missing 'min' and/or 'max' value"));if("number"!==e||"number"!==i)throw new Error("Slider (".concat(this.itemId,"): min/max values have to be of type number"));if(t.min>t.max||t.min===t.max)throw new Error("Slider (".concat(this.itemId,"): 'min' value is greater than or equal to 'max' value"));if("undefined"!==n&&(t.initial<t.min||t.initial>t.max))throw new Error("Slider (".concat(this.itemId,"): 'initial' value is not in min/max range"));if("undefined"===n&&(t.initial=t.min),0!==Math.floor(t.initial%t.stepSize))throw new Error("Slider (".concat(this.itemId,"): 'initial' is not achievable with 'stepSize'"));if("undefined"===o)t.stepSize=1;else if(t.max-t.min<=t.stepSize)throw new Error("Slider (".concat(this.itemId,"): 'stepSize' is greater or equal to slider range"));"undefined"===r&&(t.stepDist=100),this._configuration=t}},{key:"value",set:function(t){this._value!==t&&(this._value=t,this.throttledTextUpdate(""+t))},get:function(){return this._value}},{key:"ribbonGroup",get:function(){if(void 0===this._ribbonGroup)throw new Error("Ribbon group not initialized");return this._ribbonGroup}},{key:"ribbon",get:function(){if(void 0===this._ribbon)throw new Error("Ribbon not initialized");return this._ribbon}},{key:"grabDot",get:function(){if(void 0===this._grabDot)throw new Error("Grab Dot Group not initialized");return this._grabDot}},{key:"gradient",get:function(){if(void 0===this._gradient)throw new Error("Gradient not initialized");return this._gradient}},{key:"ribbonMaskGroup",get:function(){if(void 0===this._ribbonMaskGroup)throw new Error("Ribbon Mask Group not initialized");return this._ribbonMaskGroup}}])&&$t(i.prototype,n),h&&$t(i,h),e}();function Vt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}zt(Ft,"GRADIENT_LENGTH",150),zt(Ft,"RIBBON_HEIGHT",60),zt(Ft,"MASK_LENGTH_MULTIPLIER",.6);var Yt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"parse",value:function(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t.checkIds(e.id),null===n)i=new It(e.id,e.direction,e.text,e.icon?e.icon:void 0,!0);else{if(void 0===e.type||0===e.type.length)i=new It(e.id,e.direction,e.text,e.icon?e.icon:void 0);else switch(e.type){case"crankslider":i=new Nt(e.id,e.direction,e.text,e.icon?e.icon:void 0);break;case"ribbonslider":i=new Ft(e.id,e.direction,e.text,e.icon?e.icon:void 0);break;default:throw new Error("type is not in [crankslider, ribbonslider]")}n.addChild(i),t.checkAngles(i)}return t.itemIds.set(e.id,i),e.children&&e.children.forEach(function(e){t.parse(e,i)}),void 0!==e.data&&(i.data=e.data),i}},{key:"checkIds",value:function(e){if(t.itemIds.has(e)){var i=t.itemIds.get(e);console.warn("Menu Item ID '".concat(e,"' already in use by Menu Item '").concat(i.itemId,"' with Parent '").concat(i.parent.itemId,"'."))}}},{key:"checkAngles",value:function(t){if(null!==t.parent&&null!==t.parent.parent){var e=t.parent.angle,i=dt.opposite(t.angle);Math.abs(e-i)<Number.EPSILON&&console.error("Item angle clashes with back angle! Item: ".concat(t.itemId," (").concat(dt.toDeg(t.angle),"Â°) | Parent: ").concat(t.parent.itemId," (").concat(dt.toDeg(e),"Â°)"))}}}],(i=null)&&Vt(e.prototype,i),n&&Vt(e,n),t}();!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(Yt,"itemIds",new Map),i.d(e,"Menu",function(){return at}),i.d(e,"MenuParser",function(){return Yt})},41:function(t,i){t.exports=e}})});